cmake_minimum_required(VERSION 3.10)
project(wxraytracer LANGUAGES CXX C)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

if(MSVC)
# MSVC drops support for some libs we need.
set(CMAKE_REQUIRED_LIBRARIES legacy_stdio_definitions.lib)
find_library(legacy legacy_stdio_definitions)
message(${legacy})
endif()

if(!MSVC)
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++14 -pthread")
endif()

# glad
add_library(glad 3rd-party/glad/src/glad.c)
target_include_directories(glad PUBLIC 3rd-party/glad/include)
target_link_libraries(glad ${CMAKE_DL_LIBS})
target_link_libraries(glad ${legacy})

# nanogui
set(NANOGUI_BUILD_EXAMPLE OFF CACHE BOOL " " FORCE)
set(NANOGUI_BUILD_PYTHON  OFF CACHE BOOL " " FORCE)
set(NANOGUI_INSTALL       OFF CACHE BOOL " " FORCE)
add_subdirectory(nanogui)

set_property(TARGET glfw glfw_objects nanogui PROPERTY FOLDER "dependencies")

# Various preprocessor definitions have been generated by NanoGUI
add_definitions(${NANOGUI_EXTRA_DEFS})
include_directories(${NANOGUI_EXTRA_INCS})
include_directories(nanogui/include)

# forward glfw from nanogui
set(GLFW3_FOUND ON)
set(GLFW3_INCLUDE_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/ext/nanogui/ext/glfw/include)
set(GLFW3_LIBRARIES $<TARGET_FILE:nanogui>)

# assimp
set(ASSIMP_NO_EXPORT ON CACHE BOOL " " FORCE)
set(ASSIMP_BUILD_ASSIMP_TOOLS OFF CACHE BOOL " " FORCE)
set(ASSIMP_BUILD_TESTS  OFF CACHE BOOL " " FORCE)
set(ASSIMP_INSTALL_PDB  OFF CACHE BOOL " " FORCE)
set(ASSIMP_BUILD_ZLIB   ON CACHE BOOL " " FORCE)
add_subdirectory(assimp)

add_library(opt INTERFACE)
target_include_directories(opt INTERFACE 3rd-party/cxxopts/include)

add_library(stb INTERFACE)
target_include_directories(stb INTERFACE 3rd-party/stb)

add_subdirectory(raytracer)
